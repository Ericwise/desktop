#!/bin/bash

# This file creates the necessary Makefiles for building Turtl core for your
# platform.

NW_TARGET=0.9.2

function print_help {
	echo "Welcome to Turtl's (probably foolishly) hand-generated configure script."
	echo "Usage:"
	echo "  ./configure [OPTIONS]"
	echo
	echo "Options:"
	echo "  --help                      Show this help"
	echo "  --nw-target [version]       The Node-webkit version to build against (default $NW_TARGET)."
	echo
}

while test -n "$1"; do
    case "$1" in
        --help)
            print_help
			exit 0
            ;;
		--nw-target)
			NW_TARGET=$2
			shift
			;;
        *)
			CFG_ARGS="$*"
			break;
            ;;
    esac
    shift
done

if [ "$CC" == "" ]; then
	CC="gcc"
fi

echo "Generating Makefiles."

MAKEFILES=(./node_modules/turtl/Makefile.in)
for mf in "${MAKEFILES[@]}"; do
	if [ ! -f $mf ]; then
		echo "Missing makefile: $mf"
		continue
	fi
	real="`echo $mf | sed 's|\.in$||'`"
	cp $mf $real
	sed -i "s|@cc@|${CC}|g" $real
	sed -i "s|@nw_target@|${NW_TARGET}|g" $real
	echo "  generated $real"
done

